{% extends "base.html" %}
{% block title %}Manage Sub-users{% endblock %}
{% block content %}
<div class="lg-glass lg-card-lg round-2xl mb-6 max-w-2xl mx-auto">
  <div class="flex justify-between items-center mb-4">
    <div class="h2">Manage Sub-users</div>
    <a href="{{ url_for('routes.create_subuser') }}" class="btn btn-secondary text-sm">‚Üê Back to Previous Page</a>
  </div>
  {% if subusers %}
  <div class="space-y-6">
    {% for sub in subusers %}
    <form method="POST" class="lg-glass lg-card round-2xl space-y-4">
      <input type="hidden" name="sub_id" value="{{ sub.id }}">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex-1">
          <label for="name_{{ sub.id }}" class="block text-sm font-medium mb-1">Sub-user Name</label>
          <input id="name_{{ sub.id }}" type="text" name="name" value="{{ sub.name }}" required>
        </div>
        <div class="flex-1">
          <label for="machine_{{ sub.id }}" class="block text-sm font-medium mb-1">Assigned Machine</label>
          <select id="machine_{{ sub.id }}" name="machine_id" required>
            <option value="">Select a machine</option>
            {% for m in machines %}
            <option value="{{ m.id }}" {% if sub.assigned_machine_id == m.id %}selected{% endif %}>{{ m.name }} ({{ m.type }})</option>
            {% endfor %}
          </select>
        </div>
        <div class="flex flex-col gap-2 sm:items-center mt-4 sm:mt-0 sm:flex-row">
          <button type="submit" name="action" value="update" class="btn btn-primary text-sm">Update</button>
          <button type="submit" name="action" value="delete" onclick="return confirm('Are you sure you want to delete this sub-user?')" class="btn btn-secondary text-sm">Delete</button>
        </div>
      </div>
    </form>
    {% endfor %}
  </div>
  {% else %}
    <div class="lg-glass lg-card round-2xl text-dim">No sub-users created yet.</div>
  {% endif %}
</div>
{% endblock %}
