<!DOCTYPE html>
<html lang="en">
<head>
    <title>User Dashboard</title>
</head>
<body>
    <h2>Welcome, {{ current_user.email }}</h2>

    <h3>Your Claimed QR Code Batches:</h3>
    {% if batches %}
        <ul>
            {% for batch in batches %}
                <li>
                    <strong>Batch ID: {{ batch.id }}</strong> — Claimed on {{ batch.created_at.strftime('%Y-%m-%d %H:%M') }}

                    <ul>
                        {% for qr in batch.qrcodes %}
                            <li>{{ qr.qr_type }} → <a href="{{ qr.image_url }}" target="_blank">View QR</a></li>
                        {% endfor %}
                    </ul>

                    {% if not batch.machines %}
                        <!-- Only show machine form if none exist -->
                        <form method="POST" style="margin-top: 10px;">
                            <input type="hidden" name="batch_id" value="{{ batch.id }}">
                            <label>Machine Name:</label>
                            <input type="text" name="name" required>
                            <label>Type:</label>
                            <select name="type" required>
                                <option value="Embroidery">Embroidery</option>
                                <option value="Laser Cutter">Laser Cutter</option>
                                <option value="Sublimation">Sublimation</option>
                                <option value="Other">Other</option>
                            </select>
                            <button type="submit">Add Machine</button>
                        </form>
                    {% endif %}

                    {% if batch.machines %}
                        <p><strong>Machines Under This Batch:</strong></p>
                        <ul>
                            {% for machine in batch.machines %}
                                <li>{{ machine.name }} ({{ machine.type }})</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </li>
                <hr>
            {% endfor %}
        </ul>
    {% else %}
        <p>No batches claimed yet.</p>
    {% endif %}

    <div style="margin-top: 20px;">
        <a href="{{ url_for('routes.home') }}"><button>Back to Home</button></a>
        <a href="{{ url_for('routes.logout') }}"><button>Logout</button></a>
    </div>
</body>
</html>
